{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "-- Grafana --"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": 18,
  "links": [],
  "panels": [
    {
      "datasource": {
        "default": true,
        "type": "grafana-postgresql-datasource",
        "uid": "bdz3m3xs99p1cf"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            }
          },
          "links": [
            {
              "targetBlank": false,
              "title": "View Location",
              "url": "/d/aeasywjuo5pfkb?var-lat=${__data.fields[0]}&var-lon=${__data.fields[1]}&${__all_variables}\n\n\n"
            }
          ],
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byType",
              "options": "number"
            },
            "properties": [
              {
                "id": "decimals",
                "value": 2
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 14,
        "w": 11,
        "x": 0,
        "y": 0
      },
      "id": 4,
      "options": {
        "basemap": {
          "config": {},
          "name": "Layer 0",
          "type": "default"
        },
        "controls": {
          "mouseWheelZoom": true,
          "showAttribution": false,
          "showDebug": false,
          "showMeasure": false,
          "showScale": false,
          "showZoom": true
        },
        "layers": [
          {
            "config": {
              "showLegend": false,
              "style": {
                "color": {
                  "fixed": "super-light-purple"
                },
                "opacity": 0.4,
                "rotation": {
                  "fixed": 0,
                  "max": 360,
                  "min": -360,
                  "mode": "mod"
                },
                "size": {
                  "fixed": 6,
                  "max": 15,
                  "min": 2
                },
                "symbol": {
                  "fixed": "img/icons/marker/square.svg",
                  "mode": "fixed"
                },
                "symbolAlign": {
                  "horizontal": "center",
                  "vertical": "center"
                },
                "textConfig": {
                  "fontSize": 12,
                  "offsetX": 0,
                  "offsetY": 0,
                  "textAlign": "center",
                  "textBaseline": "middle"
                }
              }
            },
            "location": {
              "latitude": "lat",
              "longitude": "lon",
              "mode": "auto"
            },
            "name": "Layer 1",
            "tooltip": true,
            "type": "markers"
          },
          {
            "config": {
              "showLegend": false,
              "style": {
                "color": {
                  "fixed": "orange"
                },
                "opacity": 0.4,
                "rotation": {
                  "fixed": 0,
                  "max": 360,
                  "min": -360,
                  "mode": "mod"
                },
                "size": {
                  "fixed": 5,
                  "max": 15,
                  "min": 2
                },
                "symbol": {
                  "fixed": "img/icons/marker/square.svg",
                  "mode": "fixed"
                },
                "symbolAlign": {
                  "horizontal": "center",
                  "vertical": "center"
                },
                "textConfig": {
                  "fontSize": 12,
                  "offsetX": 0,
                  "offsetY": 0,
                  "textAlign": "center",
                  "textBaseline": "middle"
                }
              }
            },
            "filterData": {
              "id": "byRefId",
              "options": "C"
            },
            "location": {
              "latitude": "lat_ghcn",
              "longitude": "lon_ghcn",
              "mode": "coords"
            },
            "name": "Layer 3",
            "tooltip": true,
            "type": "markers"
          },
          {
            "config": {
              "showLegend": false,
              "style": {
                "color": {
                  "fixed": "light-red"
                },
                "opacity": 0.4,
                "rotation": {
                  "fixed": 0,
                  "max": 360,
                  "min": -360,
                  "mode": "mod"
                },
                "size": {
                  "fixed": 5,
                  "max": 15,
                  "min": 2
                },
                "symbol": {
                  "fixed": "img/icons/marker/square.svg",
                  "mode": "fixed"
                },
                "symbolAlign": {
                  "horizontal": "center",
                  "vertical": "center"
                },
                "textConfig": {
                  "fontSize": 12,
                  "offsetX": 0,
                  "offsetY": 0,
                  "textAlign": "center",
                  "textBaseline": "middle"
                }
              }
            },
            "filterData": {
              "id": "byRefId",
              "options": "D"
            },
            "location": {
              "latitude": "lat_tahmo",
              "longitude": "lon_tahmo",
              "mode": "coords"
            },
            "name": "Layer 4",
            "tooltip": true,
            "type": "markers"
          },
          {
            "config": {
              "showLegend": false,
              "style": {
                "color": {
                  "fixed": "dark-blue"
                },
                "opacity": 0.4,
                "rotation": {
                  "fixed": 0,
                  "max": 360,
                  "min": -360,
                  "mode": "mod"
                },
                "size": {
                  "fixed": 6,
                  "max": 15,
                  "min": 2
                },
                "symbol": {
                  "fixed": "img/icons/marker/square.svg",
                  "mode": "fixed"
                },
                "symbolAlign": {
                  "horizontal": "center",
                  "vertical": "center"
                },
                "textConfig": {
                  "fontSize": 12,
                  "offsetX": 0,
                  "offsetY": 0,
                  "textAlign": "center",
                  "textBaseline": "middle"
                }
              }
            },
            "filterData": {
              "id": "byRefId",
              "options": "B"
            },
            "location": {
              "mode": "auto"
            },
            "name": "Layer 2",
            "tooltip": false,
            "type": "markers"
          }
        ],
        "tooltip": {
          "mode": "details"
        },
        "view": {
          "allLayers": true,
          "id": "coords",
          "lat": 31.515842,
          "lon": -23.183433,
          "zoom": 1.63
        }
      },
      "pluginVersion": "11.1.0",
      "targets": [
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "bdz3m3xs99p1cf"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT DISTINCT lat as latitude, lon as longitude\nFROM \"$rainfall_tab_name\"\nWHERE era5_precip IS NOT NULL;",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "bdz3m3xs99p1cf"
          },
          "editorMode": "code",
          "format": "table",
          "hide": false,
          "rawQuery": true,
          "rawSql": "SELECT DISTINCT lat as lat_ghcn, lon as lon_ghcn\nFROM \"$rainfall_tab_name\"\nWHERE ghcn_precip IS NOT NULL;",
          "refId": "C",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "bdz3m3xs99p1cf"
          },
          "editorMode": "code",
          "format": "table",
          "hide": false,
          "rawQuery": true,
          "rawSql": "SELECT ${lat} as lat, ${lon} as lon",
          "refId": "B",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "bdz3m3xs99p1cf"
          },
          "editorMode": "code",
          "format": "table",
          "hide": false,
          "rawQuery": true,
          "rawSql": "SELECT DISTINCT lat as lat_tahmo, lon as lon_tahmo\nFROM \"$rainfall_tab_name\"\nWHERE tahmo_precip IS NOT NULL;",
          "refId": "D",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "bdz3m3xs99p1cf"
          },
          "editorMode": "code",
          "format": "table",
          "hide": false,
          "rawQuery": true,
          "rawSql": "-- SELECT \n--     AVG(lat) as avg_latitude, \n--     AVG(lon) as avg_longitude\n-- FROM \"$rainfall_tab_name\"\n-- WHERE era5_precip IS NOT NULL;",
          "refId": "E",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "Select Location",
      "type": "geomap"
    },
    {
      "datasource": {
        "default": true,
        "type": "grafana-postgresql-datasource",
        "uid": "bdz3m3xs99p1cf"
      },
      "fieldConfig": {
        "defaults": {},
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "forecast"
            },
            "properties": []
          },
          {
            "matcher": {
              "id": "byName",
              "options": "forecast"
            },
            "properties": []
          }
        ]
      },
      "gridPos": {
        "h": 14,
        "w": 13,
        "x": 11,
        "y": 0
      },
      "id": 3,
      "options": {
        "allData": {},
        "config": {},
        "data": [],
        "imgFormat": "png",
        "layout": {
          "barmode": "group",
          "font": {
            "family": "Inter, Helvetica, Arial, sans-serif"
          },
          "hoverlabel": {
            "bgcolor": "rgba(255, 255, 255, 0.95)"
          },
          "hovermode": "x unified",
          "margin": {
            "b": 30,
            "l": 40,
            "r": 10,
            "t": 5
          },
          "modebar": {
            "activecolor": "grey",
            "bgcolor": "rgba(255, 255, 255, 0)",
            "color": "lightgray",
            "orientation": "v",
            "remove": [
              "zoom2d",
              "pan2d",
              "select2d",
              "lasso2d",
              "zoomIn2d",
              "zoomOut2d"
            ]
          },
          "paper_bgcolor": "white",
          "plot_bgcolor": "white",
          "title": {
            "automargin": true
          },
          "xaxis": {
            "automargin": true,
            "autorange": true,
            "tickfont": {
              "size": 14
            },
            "ticklen": 4,
            "tickwidth": 1,
            "type": "date"
          },
          "yaxis": {
            "automargin": true,
            "autorange": true,
            "gridcolor": "rgba(0, 0, 0, 0.15)",
            "range": [
              0,
              50
            ],
            "rangemode": "tozero",
            "tickfont": {
              "size": 14
            },
            "title": {
              "font": {
                "size": 16
              },
              "standoff": 20,
              "text": "Precipitation (mm)"
            },
            "type": "linear"
          }
        },
        "onclick": "// Event handling\n/*\n// 'data', 'variables', 'options', 'utils', and 'event' are passed as arguments\n\ntry {\n  const { type: eventType, data: eventData } = event;\n  const { timeZone, dayjs, locationService, getTemplateSrv } = utils;\n\n  switch (eventType) {\n    case 'click':\n      console.log('Click event:', eventData.points);\n      break;\n    case 'select':\n      console.log('Selection event:', eventData.range);\n      break;\n    case 'zoom':\n      console.log('Zoom event:', eventData);\n      break;\n    default:\n      console.log('Unhandled event type:', eventType, eventData);\n  }\n\n  console.log('Current time zone:', timeZone);\n  console.log('From time:', dayjs(variables.__from).format());\n  console.log('To time:', dayjs(variables.__to).format());\n\n  // Example of using locationService\n  // locationService.partial({ 'var-example': 'test' }, true);\n\n} catch (error) {\n  console.error('Error in onclick handler:', error);\n}\n*/\n  ",
        "resScale": 2,
        "script": "// Helper function to check if field has values\nfunction hasValues(field) {\n    return field && field.values && field.values.length > 0;\n}\n\n// Helper function to get field values\nfunction getValues(field) {\n    return field.values || field.values.buffer;\n}\n\nlet traces = [];\nconst series1 = data.series[0];\n\n// Get time range for threshold lines (if time series exists)\nlet timeRange = [];\nif (hasValues(series1.fields[0])) {\n    const timeValues = getValues(series1.fields[0]);\n    timeRange = [Math.min(...timeValues), Math.max(...timeValues)];\n}\n\n// Define trace configurations for precipitation data\nconst traceConfigs = [\n    {\n        data: series1.fields[1], // ghcn daily precip\n        name: \"ERA5 Precip\",\n        color: '#4A90E2',\n        mode: 'lines'\n    },   \n    {\n        data: series1.fields[2], // data source daily precip\n        name: \"IMERG Precip\",\n        color: '#50C878',\n        mode: 'lines'\n    },\n    {\n        data: series1.fields[3], // data source daily precip\n        name: \"CHIRPS Precip\",\n        color: '#9B6B9E',\n        mode: 'lines'\n    },\n    {\n        data: series1.fields[4], // data source daily precip\n        name: \"GHCN Precip\",\n        color: '#E37D54',\n        mode: 'markers', // Changed from 'scatter' to explicitly use 'markers'\n        marker: {        // Added marker configuration\n            size: 2,\n            symbol: 'circle'\n        }            \n    },   \n    {\n        data: series1.fields[5], // data source daily precip\n        name: \"TAHMO Precip\",\n        color: 'red',\n        mode: 'markers', // Changed from 'scatter' to explicitly use 'markers'\n        marker: {        // Added marker configuration\n            size: 2,\n            symbol: 'circle'\n        }            \n    },            \n];\n\n// Add precipitation traces if they have data\ntraceConfigs.forEach(config => {\n    if (hasValues(config.data)) {\n        traces.push({\n            x: getValues(series1.fields[0]),\n            y: getValues(config.data),\n            type: 'scatter',\n            mode: config.mode,\n            name: config.name,\n            line: { color: config.color }\n        });\n    }\n});\n\nreturn {\n    data: traces,\n    layout: {\n        xaxis: {\n            type: 'date',\n            title: 'Time'\n        },        \n        yaxis: { \n            title: 'Precipitation (mm)' ,\n        },\n        showlegend: true,\n    }\n};",
        "syncTimeRange": false,
        "timeCol": ""
      },
      "pluginVersion": "1.8.1",
      "targets": [
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "bdz3m3xs99p1cf"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \"time\", \"era5_precip\", \"imerg_precip\", \"chirps_precip\", \"ghcn_precip\", \"tahmo_precip\"\nFROM \"$rainfall_tab_name\"\nWHERE lat = ${lat} \n AND lon = ${lon}\n AND EXTRACT(YEAR FROM \"time\") BETWEEN 2015 AND 2023\nORDER BY \"time\";",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "Daily Rainfall (mm)",
      "transparent": true,
      "type": "nline-plotlyjs-panel"
    }
  ],
  "schemaVersion": 39,
  "tags": [],
  "templating": {
    "list": [
      {
        "current": {
          "text": "Bias",
          "value": "bias"
        },
        "hide": 2,
        "includeAll": false,
        "label": "Metric",
        "name": "metric",
        "options": [
          {
            "selected": false,
            "text": "MAE",
            "value": "mae"
          },
          {
            "selected": false,
            "text": "RMSE",
            "value": "rmse"
          },
          {
            "selected": true,
            "text": "Bias",
            "value": "bias"
          }
        ],
        "query": "MAE : mae, RMSE : rmse, Bias : bias",
        "type": "custom"
      },
      {
        "current": {
          "text": "GHCN",
          "value": "ghcn"
        },
        "hide": 2,
        "includeAll": false,
        "label": "Ground Truth",
        "name": "truth",
        "options": [
          {
            "selected": true,
            "text": "GHCN",
            "value": "ghcn"
          }
        ],
        "query": "GHCN : ghcn",
        "type": "custom"
      },
      {
        "current": {
          "text": "1.5",
          "value": "global1_5"
        },
        "hide": 2,
        "includeAll": false,
        "label": "Grid",
        "name": "grid",
        "options": [
          {
            "selected": true,
            "text": "1.5",
            "value": "global1_5"
          }
        ],
        "query": "0.25 : global0_25",
        "type": "custom"
      },
      {
        "current": {
          "text": "Africa",
          "value": "africa"
        },
        "includeAll": false,
        "label": "Region",
        "name": "region",
        "options": [
          {
            "selected": true,
            "text": "Africa",
            "value": "africa"
          },
          {
            "selected": false,
            "text": "East Africa",
            "value": "east_africa"
          },
          {
            "selected": false,
            "text": "Global",
            "value": "global"
          },
          {
            "selected": false,
            "text": "CONUS",
            "value": "conus"
          }
        ],
        "query": "East Africa : east_africa, CONUS : conus",
        "type": "custom"
      },
      {
        "current": {
          "text": "None",
          "value": "None"
        },
        "hide": 2,
        "includeAll": false,
        "label": "Time Grouping",
        "name": "time_grouping",
        "options": [
          {
            "selected": true,
            "text": "None",
            "value": "None"
          },
          {
            "selected": false,
            "text": "Month of Year",
            "value": "month_of_year"
          },
          {
            "selected": false,
            "text": "Year",
            "value": "year"
          }
        ],
        "query": "None : None, Month of Year : month_of_year, Year : year",
        "type": "custom"
      },
      {
        "current": {
          "text": "37e1b34f5a17c9f86937ea0da99b9409",
          "value": "37e1b34f5a17c9f86937ea0da99b9409"
        },
        "datasource": {
          "type": "grafana-postgresql-datasource",
          "uid": "bdz3m3xs99p1cf"
        },
        "definition": "select * from md5('ground_truth_metrics_table/2022-12-31_${grid}_lsm_${metric}_${region}_2016-01-01_${time_grouping}_${truth}_tmp2m')",
        "hide": 2,
        "includeAll": false,
        "name": "tmp2m_tab_name",
        "options": [],
        "query": "select * from md5('ground_truth_metrics_table/2022-12-31_${grid}_lsm_${metric}_${region}_2016-01-01_${time_grouping}_${truth}_tmp2m')",
        "refresh": 2,
        "regex": "",
        "type": "query"
      },
      {
        "current": {
          "text": "9e911666f6add36c7a51bd2b03f564ef",
          "value": "9e911666f6add36c7a51bd2b03f564ef"
        },
        "datasource": {
          "type": "grafana-postgresql-datasource",
          "uid": "bdz3m3xs99p1cf"
        },
        "definition": "select * from md5('ground_truth_metrics_table/2022-12-31_${grid}_lsm_${metric}_${region}_2016-01-01_${time_grouping}_${truth}_precip')",
        "hide": 2,
        "includeAll": false,
        "name": "precip_tab_name",
        "options": [],
        "query": "select * from md5('ground_truth_metrics_table/2022-12-31_${grid}_lsm_${metric}_${region}_2016-01-01_${time_grouping}_${truth}_precip')",
        "refresh": 2,
        "regex": "",
        "type": "query"
      },
      {
        "current": {
          "text": "select v.* from (values ('None')) v(t)",
          "value": "select v.* from (values ('None')) v(t)"
        },
        "datasource": {
          "type": "grafana-postgresql-datasource",
          "uid": "bdz3m3xs99p1cf"
        },
        "definition": "select \nCASE\n    WHEN v.g = 'None' THEN 'select v.* from (values (''None'')) v(t)'\n    ELSE 'select distinct time from \"${precip_tab_name}\"'\nEND\nfrom (values ('$time_grouping')) v(g)",
        "hide": 2,
        "includeAll": false,
        "name": "time_filter_filter_query",
        "options": [],
        "query": "select \nCASE\n    WHEN v.g = 'None' THEN 'select v.* from (values (''None'')) v(t)'\n    ELSE 'select distinct time from \"${precip_tab_name}\"'\nEND\nfrom (values ('$time_grouping')) v(g)",
        "refresh": 1,
        "regex": "",
        "type": "query"
      },
      {
        "current": {
          "text": "None",
          "value": "None"
        },
        "datasource": {
          "type": "grafana-postgresql-datasource",
          "uid": "bdz3m3xs99p1cf"
        },
        "definition": "${time_filter_filter_query:raw}",
        "hide": 2,
        "includeAll": false,
        "label": "Time Filter",
        "name": "time_filter",
        "options": [],
        "query": "${time_filter_filter_query:raw}",
        "refresh": 1,
        "regex": "",
        "sort": 3,
        "type": "query"
      },
      {
        "current": {
          "text": "",
          "value": ""
        },
        "datasource": {
          "type": "grafana-postgresql-datasource",
          "uid": "bdz3m3xs99p1cf"
        },
        "definition": "select \nCASE\n    WHEN v.g = 'None' THEN ''\n    ELSE 'where time = ' || v.t\nEND\nfrom (values ('$time_filter', '$time_grouping')) v(t, g)",
        "hide": 2,
        "includeAll": false,
        "name": "time_filter_query",
        "options": [],
        "query": "select \nCASE\n    WHEN v.g = 'None' THEN ''\n    ELSE 'where time = ' || v.t\nEND\nfrom (values ('$time_filter', '$time_grouping')) v(t, g)",
        "refresh": 1,
        "regex": "",
        "type": "query"
      },
      {
        "current": {
          "text": "7.50",
          "value": "7.50"
        },
        "hide": 2,
        "includeAll": false,
        "name": "lat",
        "options": [
          {
            "selected": false,
            "text": "1.5",
            "value": "1.5"
          }
        ],
        "query": "1.5",
        "type": "custom"
      },
      {
        "current": {
          "text": "37.50",
          "value": "37.50"
        },
        "hide": 2,
        "includeAll": false,
        "name": "lon",
        "options": [
          {
            "selected": false,
            "text": "39.0",
            "value": "39.0"
          }
        ],
        "query": "39.0",
        "type": "custom"
      },
      {
        "current": {
          "text": "c8b6f76ccb0d5c64b0ac29e863c16812",
          "value": "c8b6f76ccb0d5c64b0ac29e863c16812"
        },
        "datasource": {
          "type": "grafana-postgresql-datasource",
          "uid": "bdz3m3xs99p1cf"
        },
        "definition": "select * from md5('rainfall_data/${agg_days}_${grid}_lsm_${region}')",
        "hide": 2,
        "includeAll": false,
        "name": "rainfall_tab_name",
        "options": [],
        "query": "select * from md5('rainfall_data/${agg_days}_${grid}_lsm_${region}')",
        "refresh": 1,
        "regex": "",
        "type": "query"
      },
      {
        "current": {
          "text": "Weekly",
          "value": "7"
        },
        "includeAll": false,
        "label": "Aggregrate",
        "name": "agg_days",
        "options": [
          {
            "selected": false,
            "text": "Daily",
            "value": "1"
          },
          {
            "selected": true,
            "text": "Weekly",
            "value": "7"
          }
        ],
        "query": "Daily : 1, Weekly : 7",
        "type": "custom"
      }
    ]
  },
  "time": {
    "from": "now-6h",
    "to": "now"
  },
  "timepicker": {},
  "timezone": "utc",
  "title": "Africa Precip Visualization",
  "uid": "aeasywjuo5pfkb",
  "version": 42,
  "weekStart": ""
}
